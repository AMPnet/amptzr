<div *ngIf="issuer$ | async as issuer" class="w-full h-full flex flex-col justify-center items-center text-gray-700">
    <div *ngIf="functionRequest$ | async as request"
        class="bg-white flex flex-col rounded-2xl shadow-sm max-w-lg w-full px-6 pt-6 pb-4">
        <img class="mb-3 h-14 object-contain" src="{{issuer.infoData.logo | toUrlIPFS}}" alt="">
        <div class="leading-6 text-sm font-medium text-center">
            <span *ngIf="request.status === 'PENDING'" class="text-violet-700">{{issuer.infoData.name}}</span>
            <div *ngIf="request.status === 'PENDING'" class="text-gray-500 font-normal">
                is requesting you to execute the following transaction
            </div>
            <div *ngIf="request.status === 'SUCCESS'" class="text-green-700 bg-green-50 rounded-lg my-2 
            py-2 flex flex-row justify-center items-center font-medium uppercase">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
                <div class="ml-2">
                    Success
                </div>              
                 
            </div>
            <div *ngIf="request.status === 'SUCCESS'" class="text-gray-500 font-normal">
                You have successfully executed a transaction as requested by  
                <div class="text-violet-700 font-semibold">{{issuer.infoData.name}}</div>    
            </div>
            <ng-template #contractSpinner>
                <app-spinner></app-spinner>
            </ng-template>
        </div>
        <div class="mt-4 flex flex-col">

            <!-- DISPLAY INFO ITEMS -->

            <div class="w-full my-2 flex flex-row justify-center text-xs font-semibold uppercase text-gray-500"
             *ngIf="request.status === 'SUCCESS'">Called function</div>

            <div class="w-full flex flex-row items-start" *ngIf="functionManifest$ | async as functionManifest">
                <div>
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                        stroke="currentColor" class="w-6 h-6 text-violet-700">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M17.25 6.75L22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3l-4.5 16.5" />
                    </svg>
                </div>

                <div class="flex flex-col ml-4 text-sm">
                    <div class="font-semibold">{{functionManifest[0].name}}</div>
                    <div class="font-light">{{functionManifest[0].description}}</div>
                </div>
            </div>

            <div class="w-full flex flex-row justify-center mt-6 items-center text-xs font-medium">
                <hr class="w-3/12 border-gray-100">
                <span class="mx-6 uppercase text-gray-500 font-semibold">on contract</span>
                <hr class="w-3/12 border-gray-100">
            </div>

            <div class="flex flex-row justify-start items-start mt-5
            rounded-lg text-sm font-medium text-gray-700 mb-2">
                <div>
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                        stroke="currentColor" class="w-6 h-6 text-violet-700">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                    </svg>
                </div>

                <div class="text-gray-700 text-sm ml-4" *ngIf="manifest$ | async as contract; else detailsLoading">
                    <div class="font-semibold mb-1">{{contract.name}}
                        <span class="font-light text-gray-500">
                            ({{request.contract_address | addrShort}})
                            <app-explorer-link [value]="request.contract_address"></app-explorer-link>
                        </span>
                    </div>
                    <div class="font-light">{{contract.description}}</div>
                </div>
            </div>

            <div *ngIf="request.function_params.length > 0">
                <div class="w-full flex flex-row justify-center mt-4 items-center text-xs font-medium">
                    <hr class="w-3/12 border-gray-100">
                    <span class="mx-6 uppercase text-gray-500 font-semibold">with parameters</span>
                    <hr class="w-3/12 border-gray-100">
                </div>

                <div *ngIf="functionManifest$ | async as manifest; else detailsLoading"
                    class="w-full flex flex-row mt-4">
                    <div class="mr-4">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                            stroke="currentColor" class="w-6 h-6 text-violet-700">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z" />
                        </svg>
                    </div>
                    <div class="flex flex-col">
                        <div class="flex flex-col w-full text-sm mb-4"
                            *ngFor="let param of request.function_params; let i = index">
                            <div class="flex flex-row">
                                <div class="flex-col">
                                    <div class="font-semibold mr-1">{{manifest[0].inputs[i].name}}:</div>
                                </div>
                                <div class="overflow-x-auto">
                                    <div *ngIf="param.type === 'address'; else regularParam">
                                        {{param.value | addrShort}}
                                    </div>
                                    <ng-template #regularParam>
                                        {{param.value}}
                                    </ng-template>
                                </div>
                            </div>
                            <div class="text-sm text-gray-500">
                                {{manifest[0].inputs[i].description}}
                            </div>
                        </div>
                    </div>
                </div>
            </div>



            <!-- END DISPLAY INFO ITEMS -->

            <div *ngIf="request.status === 'PENDING'" [class.!hidden]="(isWaitingForTx$ | async)" class="flex flex-col w-full mt-4">
                <button app-action-button text="Execute now" class="bg-violet-700 text-white font-semibold 
                    py-2 w-full rounded-lg hover:bg-violet-800 shadow-md hover:shadow-xl"
                    [onClick]="executeFunction(request).bind(this)"
                    *ngIf="isLoggedIn$ | async; else notLoggedIn"></button>

                <ng-template #notLoggedIn>
                    <button app-action-button class="mt-4 py-2 bg-violet-700 text-white rounded-lg hover:bg-violet-900"
                        text="Log In" [onClick]="login.bind(this)"></button>
                </ng-template>
                <button
                    class="mt-3 py-2 w-full transition-all tracking-wide
                    text-gray-500 text-xs hover:text-violet-800 hover:font-bold font-medium uppercase rounded-lg flex flex-row items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor" class="w-4 h-4">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M4.5 12c0-1.232.046-2.453.138-3.662a4.006 4.006 0 013.7-3.7 48.678 48.678 0 017.324 0 4.006 4.006 0 013.7 3.7c.017.22.032.441.046.662M4.5 12l-3-3m3 3l3-3m12 3c0 1.232-.046 2.453-.138 3.662a4.006 4.006 0 01-3.7 3.7 48.657 48.657 0 01-7.324 0 4.006 4.006 0 01-3.7-3.7c-.017-.22-.032-.441-.046-.662M19.5 12l-3 3m3-3l3 3" />
                    </svg>
                    <div class="ml-2">Simulate transaction</div>
                </button>
            </div>

            <div *ngIf="isWaitingForTx$ | async">
                <div class="w-full py-2 bg-violet-50 flex mt-2 flex-row items-center justify-center rounded-lg">
                    <span class="font-semibold text-violet-700 text-sm  flex flex-row items-center justify-center">
                        <app-spinner></app-spinner>
                        <div class="ml-2">Processing</div>
                    </span>
                </div>
            </div>

        </div>
    </div>
    <div class="max-w-md text-xs mt-4 text-gray-500 text-center">
        <div>This is a state changing request. Make sure you trust {{issuer.infoData.name}} before proceeding with this
            action.</div>
    </div>
</div>

<ng-template #detailsLoading>
    <div class="w-full flex flex-row justify-center items-center">
        <app-spinner></app-spinner>
    </div>
</ng-template>