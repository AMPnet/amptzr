<div *ngIf="(progressData$ | async) as dataRes" class="flex items-center justify-center min-h-[5rem]">
  <ng-container *ngIf="dataRes.value as data">
    <ng-container *ngIf="campaign">
      <div *ngIf="!campaign.canceled && !campaign.finalized" class="w-full">
        <div>
          <span class="mt-6 font-semibold text-cyan-600 text-lg">
            {{ data.raised | formatUnit:'stablecoin' | currencyDefault:'stablecoin':'implicit' }}
          </span>
          <span class="mx-1 text-sm text-gray-500">
            of {{ data.target | formatUnit:'stablecoin' | currencyDefault:'stablecoin':'implicit' }}
            target
          </span>
        </div>

        <div class="relative h-8 rounded-lg overflow-hidden grid pt-1">
          <!-- Progress tray -->
          <div class="absolute w-full h-full"
               [ngClass]="data.isStarted ? 'bg-cyan-500/50' : 'bg-gray-400'">
          </div>

          <!-- Progress amount tray -->
          <div class="absolute h-full bg-gradient-to-r"
               [ngClass]="data.isRaisedOverSoftCap ? 'from-sky-600 to-violet-500' : 'from-sky-600 to-cyan-500'"
               [style.width.%]="data.progressPercentage * 100"></div>

          <!-- Text over tray -->
          <div class="absolute h-full font-bold text-white uppercase
                      flex items-center pl-2">
            <span [ngSwitch]="true">
              <ng-container *ngSwitchCase="!data.isStarted">
                Not started
              </ng-container>
              <ng-container *ngSwitchDefault>
                {{ data.raisedPercentage | percent:'1.0-2' }} funded
              </ng-container>
            </span>
          </div>
        </div>

        <div class="flex justify-between mt-1">
          <div [ngSwitch]="true">
            <span *ngSwitchCase="data.isRaisedOverSoftCap && !data.isFull" class="text-sm text-cyan-600 font-bold">
              Open for funding
            </span>
            <span *ngSwitchCase="data.isFull" class="text-sm text-green-500 font-semibold">
              Max target reached
            </span>
            <span *ngSwitchDefault class="text-sm font-light text-gray-500">
              <ng-container [ngSwitch]="true">
                <ng-container *ngSwitchCase="!!campaign.infoData.startDate && !!campaign.infoData.endDate">
                  {{ campaign.infoData.startDate | date:'mediumDate' }}
                  - {{ campaign.infoData.endDate | date:'mediumDate' }}
                </ng-container>
                <ng-container *ngSwitchCase="!!campaign.infoData.startDate && !campaign.infoData.endDate">
                  From {{ campaign.infoData.startDate | date:'mediumDate' }}
                </ng-container>
                <ng-container *ngSwitchCase="!campaign.infoData.startDate && !!campaign.infoData.endDate">
                  Until {{ campaign.infoData.endDate | date:'mediumDate' }}
                </ng-container>
              </ng-container>
            </span>
          </div>
          <div [ngSwitch]="true">
            <span *ngSwitchCase="data.softCap.gt(bigNumberConstants.Zero) && data.total.gt(data.softCap)"
                  class="text-sm text-gray-500 font-light">
              Max target {{ data.total | formatUnit:'stablecoin' | currencyDefault:'stablecoin':'implicit' }}
            </span>
          </div>
        </div>
      </div>

      <div *ngIf="campaign.finalized" class="w-full">
        <div>
          <span class="mt-6 font-bold text-cyan-600 text-lg uppercase">
            {{ data.raised | formatUnit:'stablecoin' | currencyDefault:'stablecoin':'implicit' }}
          </span> raised
        </div>

        <div class="flex justify-between mt-2">
          <div class="font-bold text-cyan-600 text-sm uppercase">
            finished
          </div>

          <div class="font-light text-gray-500 text-sm">
          </div>
        </div>
      </div>
    </ng-container>
  </ng-container>

  <ng-container *ngIf="dataRes.loading">
    <app-spinner type="inline-xs"></app-spinner>
  </ng-container>

  <ng-container *ngIf="dataRes.error">
    Cannot fetch funding progress.
    <div hidden>{{ dataRes.error | json }}</div>
  </ng-container>
</div>
