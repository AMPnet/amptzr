<div class="max-w-6xl mx-auto px-4">
  <div class="mt-6 rounded-3xl shadow-lg bg-white p-4 lg:p-6">
    <div class="flex flex-col">
      <b class="text-sm">Your balance:</b>
      <div class="mt-2 lg:flex lg:w-full lg:items-center lg:justify-between">
        <span class="text-3xl mr-8 font-light">
          <ng-container *ngIf="(balance$ | async) as balanceRes">
            <ng-container *ngIf="balanceRes.value as balance">
              {{ balance | formatUnit:'bignumToWei' | currencyDefault }}
            </ng-container>

            <ng-container *ngIf="balanceRes.error">
              ‚ùå
              <div hidden>{{ balanceRes.error | json }}</div>
            </ng-container>

            <ng-container *ngIf="balanceRes.loading">
              <app-spinner></app-spinner>
            </ng-container>
          </ng-container>
        </span>

        <!-- Action buttons (deposit, withdraw...) -->
        <div class="flex items-center justify-between space-x-2 mt-2 lg:mt-0">
          <button class="flex items-center justify-center text-white w-full lg:w-auto text-sm rounded-full
                         bg-green-600 hover:bg-green-700 py-4 mt-2 lg:mt-0 lg:px-8"
                  [routerLink]="'/deposit' | issuerPath">
            <svg class="h-3.5 w-3.5 mr-2" width="18" height="14" viewBox="0 0 18 14" fill="none"
                 xmlns="http://www.w3.org/2000/svg">
              <path d="M8.78568 1V7M8.78568 7V13M8.78568 7H16.0255M8.78568 7H1.5459" stroke="white" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span class="font-semibold tracking-wider">Deposit</span>
          </button>
          <button class="flex items-center justify-center text-white w-full lg:w-auto text-sm rounded-full
                        bg-indigo-800 hover:bg-indigo-900 py-4 mt-2 lg:mt-0 lg:px-8
                        disabled:bg-gray-200 disabled:cursor-not-allowed"
                  disabled>
            <svg class="h-3.5 w-3.5 mr-2" width="22" height="18" viewBox="0 0 22 18" fill="none"
                 xmlns="http://www.w3.org/2000/svg">
              <path
                d="M1.47461 13V14C1.47461 14.7956 1.85599 15.5587 2.53485 16.1213C3.21371 16.6839 4.13444 17 5.0945 17H17.1608C18.1209 17 19.0416 16.6839 19.7204 16.1213C20.3993 15.5587 20.7807 14.7956 20.7807 14V13M15.9542 9L11.1276 13M11.1276 13L6.30113 9M11.1276 13V1"
                stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span class="font-semibold tracking-wider">Withdraw</span>
          </button>
        </div>
      </div>

      <!-- Wallet Info - User Identity, Provider, Address -->
      <div class="flex flex-col lg:flex-row text-xs lg:items-center justify-between mt-4">
        <!-- TODO: fetch actual user name -->
        <p class="flex-grow invisible">{{ userIdentity$ | async }}</p>
        <div class="flex items-center mt-2 lg:mt-0">
          <ng-container *ngIf="(address$ | async) as address">
            <span class="flex-grow-0 mr-6">Wallet address: {{ address | addrShort }}</span>
            <app-value-copy [value]="address" [delay]="1500"
                            textReady="Copy address" textCopied="Copied">
            </app-value-copy>
          </ng-container>
        </div>
        <span class="flex-grow-0 mt-2 lg:mt-0">
          Connected with:
          <ng-container *ngIf="(authProvider$ | async) as authProvider">
            <b>{{ authProvider | authProviderName }}</b>
            <button app-action-button *ngIf="authProvider === authProviderType.VENLY"
                    [onClick]="manageVenlyWallets.bind(this)">
              <ng-template #content #loadingContent>
                <span class="underline mx-1">(Manage wallets)</span>
              </ng-template>
            </button>
          </ng-container>
        </span>
        <span class="flex flex-col items-end">
          <button class="flex inline-flex items-center justify-center flex-grow-0 bg-gray-300 hover:bg-gray-400
                         rounded-full ml-4 py-1 px-2" (click)="logout()">
            <svg class="h-4 w-4 mr-2" width="18" height="16" viewBox="0 0 18 16" fill="none"
                 xmlns="http://www.w3.org/2000/svg">
              <path
                d="M13.1667 11.3335L16.5 8.00016M16.5 8.00016L13.1667 4.66683M16.5 8.00016H4.83333M9.83333 11.3335V12.1668C9.83333 12.8299 9.56994 13.4658 9.1011 13.9346C8.63226 14.4034 7.99637 14.6668 7.33333 14.6668H4C3.33696 14.6668 2.70107 14.4034 2.23223 13.9346C1.76339 13.4658 1.5 12.8299 1.5 12.1668V3.8335C1.5 3.17045 1.76339 2.53457 2.23223 2.06573C2.70107 1.59689 3.33696 1.3335 4 1.3335H7.33333C7.99637 1.3335 8.63226 1.59689 9.1011 2.06573C9.56994 2.53457 9.83333 3.17045 9.83333 3.8335V4.66683"
                stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <b>Log out</b>
          </button>
        </span>
      </div>
    </div>
  </div>

  <!-- Transaction History Component -->
  <div class="flex flex-col mt-6">
    <div class="flex flex-row justify-between items-center">
      <span class="font-semibold">Transaction History</span>
      <button class="flex items-center justify-center text-white w-full lg:w-auto text-sm rounded-full
                     bg-indigo-800 hover:bg-indigo-900 py-4 mt-2 lg:mt-0 lg:px-8"
              (click)="downloadTransactionHistory()">
        <svg class="h-3.5 w-3.5 mr-2" width="22" height="18" viewBox="0 0 22 18" fill="none"
             xmlns="http://www.w3.org/2000/svg">
          <path
            d="M1.47461 13V14C1.47461 14.7956 1.85599 15.5587 2.53485 16.1213C3.21371 16.6839 4.13444 17 5.0945 17H17.1608C18.1209 17 19.0416 16.6839 19.7204 16.1213C20.3993 15.5587 20.7807 14.7956 20.7807 14V13M15.9542 9L11.1276 13M11.1276 13L6.30113 9M11.1276 13V1"
            stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span class="font-semibold tracking-wider">Download</span>
      </button>
    </div>
    <div class="flex flex-col mt-4">
      <ng-container *ngIf="transactionHistory$ | async as txHistoryRes">
        <ng-container *ngIf="txHistoryRes.value as txHistory">
          <div *ngFor="let transaction of txHistory.transactions; let i = index"
               class="rounded-xl whitespace-nowrap shadow-md bg-white p-4 my-1.5 flex items-center justify-between">
            <div class="flex">
              <div *ngIf="!isOutgoingTransaction(transaction)"
                   class="rounded-full w-10 h-10 bg-green-600 flex justify-center items-center text-white">
                <svg width="18" height="18" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path
                    d="M13.7546 24.0815L5.89748 15.9999M5.89748 15.9999L13.7546 7.91828M5.89748 15.9999L26.1016 15.9999"
                    stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
              <div *ngIf="isOutgoingTransaction(transaction)"
                   class="rounded-full w-10 h-10 bg-pink-600 flex justify-center items-center text-white">
                <svg width="18" height="18" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M18.2454 7.91846L26.1025 16.0001M26.1025 16.0001L18.2454 24.0817M26.1025 16.0001H5.89844"
                        stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
              <div class="flex flex-col ml-4">
                <span class="font-semibold">{{ transaction.type | transactionTypeName }}</span>
                <ng-container *ngIf="txHistory.campaignNames$[i] | async as campaignNameRes">
                  <span *ngIf="campaignNameRes.value as campaignName">{{ campaignName }}</span>

                  <ng-container *ngIf="campaignNameRes.error">
                    Unable to fetch campaign name.
                    <div hidden>{{ txHistoryRes.error | json }}</div>
                  </ng-container>

                  <ng-container *ngIf="campaignNameRes.loading">
                    <app-spinner type="inline-base"></app-spinner>
                  </ng-container>
                </ng-container>
              </div>
            </div>
            <div class="text-right float-right">
              <div class="font-semibold">
                {{ transactionValueSign(transaction) }}
                {{ transaction.token_value | formatUnit:'bignumToWei' | currencyDefault }}
              </div>
              <div>
                {{ transaction.timestamp | date:'dd. MM. yyyy.' }}
              </div>
            </div>
          </div>
        </ng-container>

        <ng-container *ngIf="txHistoryRes.error">
          Cannot fetch transaction history.
          <div hidden>{{ txHistoryRes.error | json }}</div>
        </ng-container>

        <ng-container *ngIf="txHistoryRes.loading">
          <app-spinner type="overlay">Loading transaction history...</app-spinner>
        </ng-container>
      </ng-container>
    </div>
  </div>
</div>
